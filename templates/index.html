<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SouthWest Innovation Lab</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="/static/css/animate.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">

    <link href="/static/css/plugins/iCheck/custom.css" rel="stylesheet">

    <link href="/static/css/plugins/fullcalendar/fullcalendar.css" rel="stylesheet">
    <link href="/static/css/plugins/fullcalendar/fullcalendar.print.css" rel='stylesheet' media='print'>

</head>

<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                    	<span><img alt="image" class="img-circle" src="/static/img/profile_small.jpg" /></span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">Einsgate Wong</strong>
                             </span> <span class="text-muted text-xs block">Project Manager<b class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Profile</a></li>
                            <li><a href="contacts.html">Contacts</a></li>
                            <li><a href="mailbox.html">Mailbox</a></li>
                            <li class="divider"></li>
                            <li><a href="login.html">Logout</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        SwIRL
                    </div>
                </li>
                <li class="active">
                    <a href="index"><i class="fa fa-th-large"></i> <span class="nav-label">Overall</span></a>
                </li>
                <li>
                    <a href="layouts.html"><i class="fa fa-diamond"></i> <span class="nav-label">User Management</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li class="active"><a href="roleList">Role Management</a></li>
                        <li><a href="staffList">Staff Management</a></li>
                        <li><a href="teamLeaderList">Leader Management</a></li>
                        <li><a href="memberList">Member Management</a></li>
                    </ul>                    
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">Statistics</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="graph_morris.html">Overall</a></li>
                        <li><a href="graph_rickshaw.html">Space Reserve Statistics</a></li>
                        <li><a href="graph_chartjs.html">Training Statistics</a></li>
                        <li><a href="graph_chartist.html">Register Statistics</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-pie-chart"></i> <span class="nav-label">Space Reserve</span> <span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="spaceLayout">Layout</a></li>
                        <li><a href="calendar.html">Reserve Space</a></li>
                        <li><a href="reservation/list">View Reservations</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-flask"></i> <span class="nav-label">Team Management</span> <span class="fa arrow"></span> </a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="teams_board.html">Team List</a></li>
                        <li><a href="applyTeam">Apply Team</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-edit"></i> <span class="nav-label">Training Management</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="projects.html">Training List</a></li>
                        <li><a href="applyTraining">Apply Training</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">Task Management</span></a>
                    <ul class="nav nav-second-level collapse">
                        <li><a href="projects.html">Task List</a></li>
                        <li><a href="profile.html">Create Task</a></li>
                        <li><a href="timeline.html">Tracking Task</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
        <div id="page-wrapper" class="gray-bg" style="min-height: 1702.06px;">
            <div class="row border-bottom">
            <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
            </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Welcome to SouthWest Innovation Lab SharedSpace.</span>
                    </li>
                    <li>
                        <a href="login.html">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>
            </nav>
    
            </div>
            <div class="wrapper wrapper-content">
                <div class="row animated fadeInDown">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Layout</h5>
                            </div>
                            <div class="ibox-content">
                                <img src="/static/img/layout.jpg" alt="layout">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row animated fadeInDown">
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Space</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    
                                    
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <div id="external-events">
                                    <p>Drag an event and enter the calendar.</p>
                                    
                                    {% for zone in zone_list %}
                                        <!--<div class="external-event navy-bg ui-draggable ui-draggable-handle" style="position: relative; text-align: center; z-index: auto; left: 0px; top: 0px; background-color: #f8ac59;" data-color='#f8ac59'>Zone 1</div>-->
                                        <div class="external-event navy-bg ui-draggable ui-draggable-handle" style="position: relative; text-align: center; background-color: #1ab394;" data-color='#1ab394' id='{{ zone.id }}'>{{ zone.name }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Reservation</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                        <i class="fa fa-wrench"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-user">
                                        <li><a href="#">Short-Term Reservation</a>
                                        </li>
                                        <li><a href="#">Long-Term Reservation</a>
                                        </li>
                                    </ul>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <form role="form" id="reservation-form">
                                    <div class="form-group"><label>Title</label> <input type="text" class="form-control" id="reservation-title" placeholder="untitled"></div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <label>Type</label> 
                                        <select class="form-control m-b" id="reservation-type">
                                            <option>closed</option>
                                            <option>quiet</option>
                                            <option selected="selected">open</option>
                                        </select>
                                    </div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group"><label>Description</label> <textarea class="form-control" rows="5" id="reservation-description"></textarea> </div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <button class="btn btn-primary" type="submit" id="reservation-button">Submit</button>
                                        <button class="btn btn-white pull-right" type="reset" id="reservation-reset-button">Reset</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Reservation Date </h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <div id="calendar"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="pull-right">
                    10GB of <strong>250GB</strong> Free.
                </div>
                <div>
                    <strong>Copyright</strong> Example Company &copy; 2014-2017
                </div>
            </div>
        </div>

    </div>

    <!-- Mainly scripts -->
    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="/static/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    
    <script src="/static/js/plugins/fullcalendar/moment.min.js"></script>
    
    <!-- Flot -->
    <script src="/static/js/plugins/flot/jquery.flot.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="/static/js/plugins/flot/jquery.flot.time.js"></script>
    <!-- Custom and plugin javascript -->
    <script src="/static/js/inspinia.js"></script>
    <script src="/static/js/plugins/pace/pace.min.js"></script>
    <!-- Sparkline -->
    <script src="/static/js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <script>
        $(document).ready(function() {

            var sparklineCharts = function(){
                $("#sparkline1").sparkline([34, 43, 43, 35, 44, 32, 44, 52], {
                    type: 'line',
                    width: '100%',
                    height: '50',
                    lineColor: '#f8ac59',
                    fillColor: "transparent"
                });

                $("#sparkline2").sparkline([32, 11, 25, 37, 41, 32, 34, 42], {
                    type: 'line',
                    width: '100%',
                    height: '50',
                    lineColor: '#f8ac59',
                    fillColor: "transparent"
                });

                $("#sparkline3").sparkline([34, 22, 24, 41, 10, 18, 16,8], {
                    type: 'line',
                    width: '100%',
                    height: '50',
                    lineColor: '#1C84C6',
                    fillColor: "transparent"
                });
            };

            var sparkResize;

            $(window).resize(function(e) {
                clearTimeout(sparkResize);
                sparkResize = setTimeout(sparklineCharts, 500);
            });

            sparklineCharts();

            var data1 = [
                [0,4],[1,8],[2,5],[3,10],[4,4],[5,16],[6,5],[7,11],[8,6],[9,11],[10,20],[11,10],[12,13],[13,4],[14,7],[15,8],[16,12]
            ];
            var data2 = [
                [0,0],[1,2],[2,7],[3,4],[4,11],[5,4],[6,2],[7,5],[8,11],[9,5],[10,4],[11,1],[12,5],[13,2],[14,5],[15,2],[16,0]
            ];
            $("#flot-dashboard5-chart").length && $.plot($("#flot-dashboard5-chart"), [
                        data1,  data2
                    ],
                    {
                        series: {
                            lines: {
                                show: false,
                                fill: true
                            },
                            splines: {
                                show: true,
                                tension: 0.4,
                                lineWidth: 1,
                                fill: 0.4
                            },
                            points: {
                                radius: 0,
                                show: true
                            },
                            shadowSize: 2
                        },
                        grid: {
                            hoverable: true,
                            clickable: true,

                            borderWidth: 2,
                            color: 'transparent'
                        },
                        colors: ["#f8ac59", "#1C84C6"],
                        xaxis:{
                        },
                        yaxis: {
                        },
                        tooltip: false
                    }
            );

        });
    </script>
    
    <!-- jQuery UI  -->
    <script src="/static/js/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- iCheck -->
    <script src="/static/js/plugins/iCheck/icheck.min.js"></script>

    <!-- Full Calendar -->
    <script src="/static/js/plugins/fullcalendar/fullcalendar.min.js"></script>

    <script>
        $(document).ready(function() {

            /* initialize the external events
             -----------------------------------------------------------------*/


            $('#external-events div.external-event').each(function() {

                // store data so the calendar knows to render an event upon drop
                $(this).data('event', {
                    is_new: "new", 
                    title: $.trim($(this).text()), // use the element's text as the event title
                    zone_id: $(this).attr('id'),
                    stick: true, // maintain when user navigates (see docs on the renderEvent method)
                    color: $(this).data('color'), 
                    editable: true
                });

                // make the event draggable using jQuery UI
                $(this).draggable({
                    zIndex: 1111999,
                    revert: true, // will cause the event to go back to its
                    revertDuration: 0 //  original position after the drag
                });

            });


            /* initialize the calendar
             -----------------------------------------------------------------*/
            var date = new Date();
            var d = date.getDate();
            var m = date.getMonth();
            var y = date.getFullYear();
            var results = [];
            
            $.ajax({
                url: '{% url "reservation_list" %}',
                type: "GET",
                success: function(data) {
                    if (data.error_code == 0) {
                        jQuery.each(data.results, function (i, item) {
                            results.push({
                                title: item.zone_name,
                                start: new Date(item.start_time),
                                end: new Date(item.end_time),
                                allDay: item.is_long_term,
                                timezone: "America/Chicago",
                            });
                        });
                        $('#calendar').fullCalendar('addEventSource', results);
                    }
                },
            });


            var reservation_counter = 0;
            var reservation_limit = 1;
            $('#calendar').fullCalendar({
                //timezone: false,
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                editable: false,
                droppable: true, // this allows things to be dropped onto the calendar
                //events: results, 
                eventColor: '#f8ac59', 
                
                drop: function() {
                    reservation_counter++;
                    if (reservation_counter >= reservation_limit) {
                        //alert('limit reached!');
                        $(this).droppable("disable");
                    }
                },
                
                eventRender: function ( event, element ) {
                    element.attr( 'id', event.id );
                }, 
                
            });

            $('#calendar').fullCalendar('option', 'timezone', 'local');

            


        });
    </script>
    <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278138285'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/z_stat.php%3Fid%3D1278138285%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
    </script>
    
    <script>
        $("#reservation-reset-button").on("click", function() {
            window.location.reload();
        })
    
        $("#reservation-form").on("submit", function(){
        
            var title = document.getElementById("reservation-title").value;
            var reservation_type = document.getElementById("reservation-type").selectedIndex;
            var description = document.getElementById("reservation-description").value;
            
            var reservations = $('#calendar').fullCalendar( 'clientEvents', function(event) {
                if (event.is_new == 'new') {
                    return true;
                }
                else {
                    return false;
                }
            });
            
            if (reservations.length > 1) {
                alert("You can only make 1 reservation each time!");
                //location.reload(true);
                return false;
            }
            else if (reservations.length == 0) {
                return false;
            }
                
            var reservation = reservations[0];
            
            
            var zone_id = reservation.zone_id;
            var zone_name = reservation.title;
            var start_time = new Date(reservation.start.toISOString());
            var end_time;
            
            alert(reservation.start);
            alert(start_time);
            if (reservation.allDay) {
                start_time = new Date(start_time.getUTCFullYear(), start_time.getUTCMonth(), start_time.getUTCDate());
                alert(start_time);
               
                if (reservation.end == null) {
                    end_time = new Date(start_time);
                    end_time.setDate(end_time.getDate() + 1);
                } else {
                    end_time = new Date(reservation.end.toISOString());
                }
            
            } else {
                if (reservation.end == null) {
                    end_time = new Date(start_time);
                    end_time.setHours(end_time.getHours() + 2);
                } else {
                    end_time = new Date(reservation.end.toISOString());
                }
            }
            
           // alert(end_time);
            
            // return;
            
            var user_id = 1;
            
            window.confirm( title + ' at ' + reservation.title + ' from ' + start_time.toLocaleString() + ' to ' + end_time.toLocaleString() + '?');
            
            $.ajax({
                url: '{% url "reservation_create" %}',
                type: "POST",
                data: JSON.stringify({ 
                    title: title,  
                    reservation_type: reservation_type, 
                    description: description, 
                    zone_id: zone_id, 
                    zone_name: zone_name,
                    start_time: start_time, 
                    end_time: end_time, 
                    user_id: user_id,
                    is_long_term: reservation.allDay
                }),
                success: function(data) {
                    console.log(data);
                    if (data.error_code == 0) {
                        alert("SUCCESS");
                    } else {
                        alert("Oops! We have encountered an error " + data.error_msg + "!");
                    }
                },
            });
        
        });

    </script>

</body>
</html>
