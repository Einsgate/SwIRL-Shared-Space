<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Southwest Innovation Research Lab - {{ training_list_title }}</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- FooTable -->
    <link href="/static/css/plugins/footable/footable.core.css" rel="stylesheet">
    <link href="/static/css/animate.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="/static/css/plugins/datapicker/bootstrap-datetimepicker.min.css" rel="stylesheet">
</head>

<body>
    <div id="wrapper">
		{% include 'common/nav.html' %}
        <div id="page-wrapper" class="gray-bg">
        {% include 'common/logout.html' %}

        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2>{{ training_list_title }}</h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="/index.html">Home</a>
                    </li>
                    <li class="active">
                        <strong>{{ training_list_title }}</strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>

        <div class="wrapper wrapper-content animated fadeInRight ecommerce">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox">
                        <div class="ibox-content">

                            <table class="footable table table-stripped toggle-arrow-tiny" data-page-size="15">
                                <thead>
	                                <tr>
	                                    <th data-hide="phone">Training</th>
	                                    <th data-hide="all">Description</th>
	                                    <th data-hide="phone">Start Time</th>
	                                    <th data-hide="phone">End Time</th>
	                                    <th data-hide="phone">Status</th>
	                                    <th class="text-right">Action</th>
	                                </tr>
                                </thead>
                                <tbody id="training_list">
                                	{% for t in training %}  
	                                <tr id="instructor_id_{{t.id}}">
	                                    <td><a href="trainingResult/{{t.id}}">{{t.name}}</a></td>
	                                    <td>{{t.description}}</td>
	                                    <td>{{t.start_time}}</td>
	                                    <td>{{t.end_time}}</td>
	                                    <td>
	                                    {% if t.training_status == 2 %}
	                                    	<span class="label label-primary"> Finished </span>
	                                    {% elif t.training_status == 3 %}
	                                    	<span class="label label-warning"> Graded </span>
	                                   	{% else %}
	                                   		<span class="label label-danger"> Processing </span>
	                                    {% endif %}
	                                    </td>
	                                    <td class="text-right">
	                                        <div class="btn-group">
	                                            {% if request.user.role_id.id == 0 or request.user.role_id.id == 1 %}
	                                            	{% if t.training_status == 0 or t.training_status == 1 %}
	                                            	<button id="finishSubmit" onclick="finishItem('{{t.id}}')" class="btn-white btn btn-xs">Finish</button>
	                                            	{% endif %}
	                                            <button id="deleteSubmit" onclick="deleteItem('{{t.id}}')" class="btn-white btn btn-xs">Delete</button>
	                                            {% endif %}
	                                        </div>
	                                    </td>
	                                </tr>
									{% endfor %}
								  </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="9">
                                        <ul class="pagination pull-right"></ul>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Only a user with high authority can add a team. -->
            <!-- TODO: to make sure which authority level is here -->
            {% if request.user.role_id.id == 0 or request.user.role_id.id == 1 %}
            <div class="row">
                <div class="col-lg-12">
                    <button class="btn btn-primary  pull-right" type="button" id="training-add-button", style="align: right">Add</button> 
                   
                    <!-- The popup dialog to create a team. -->
                    <!-- Modal -->
                    <div class="modal fade" id="trainingModal" role="dialog">
                        <div class="modal-dialog">
                        
                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-header" style="padding:35px 50px;">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4>Create a training</h4>
                            </div>
                            <div class="modal-body" style="padding:40px 50px;">
                                <form role="form">
                                    <!--<div class="form-group">-->
                                    <!--    <label>Team Leader</label>-->
                                    <!--    <input type="text" disabled="" placeholder="{{request.user.username}}" class="form-control"  id="team-leader">-->
                                    <!--</div>-->
                                    <div class="form-group">
                                        <label>Training Title</label>
                                        <input type="text" class="form-control" id="trainingName">
                                        <label>Description of Details</label>
                                        <textarea class="form-control" id="trainingDesc" ></textarea>
			                           <div class="form-group" id="startTime">
			                               <label class="font-normal">Start Time</label>
			                               <div class="input-group date">
			                                   <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" id='startDate' class="form-control" value="">
			                               </div>
			                           </div>
			                           <div class="form-group" id="endTime">
			                               <label class="font-normal">End Time</label>
			                               <div class="input-group date">
			                                   <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" id='endDate' class="form-control" value="">
			                               </div>
			                           </div>

                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" type="submit" id="training-submit-button" value={{request.user.id}}>Add</button>
                                <!--<button class="btn btn-white pull-right" type="close" id="team-cancel-button">Cancel</button>-->
                            </div>
                          </div>
                          
                        </div>
                      </div> 
                </div>
            </div>
            {% endif %}
        </div>
        <div class="footer">
			{% include 'common/footer.html' %}
        </div>

        </div>
        </div>

    <!-- Mainly scripts -->
    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="/static/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Data picker -->
    <!-- script src="/static/js/plugins/datapicker/bootstrap-datepicker.js"></script -->
    <script src="/static/js/plugins/datapicker/bootstrap-datetimepicker.js"></script>
    <script src="/static/js/plugins/datapicker/bootstrap-datetimepicker.ua.js" charset="UTF-8"></script>

    <!-- Custom and plugin javascript -->
    <script src="/static/js/inspinia.js"></script>
    <script src="/static/js/plugins/pace/pace.min.js"></script>

    <!-- FooTable -->
    <script src="/static/js/plugins/footable/footable.all.min.js"></script>
    
    <script>
		function apply(id) {
			if(confirm("Are you sure to Apply?")){
		        $.ajax({
		            url:'{% url "training_apply" %}',
		            data:JSON.stringify({id: id, user_id: user_id, start_time: start_time, end_time: end_time, zone_id: zone_id}),
                    type: "POST",
		            success:function(msg){
		            	$(location).attr('href','{% url "training_view" %}');
		            },
		            error:function(xhr,textstatus,thrown){
		            }
		        });
		        return true;
			}else{
				alert("Cancel Apply Operation");
			}
		}

		function deleteItem(id) {
			if(confirm("Are you sure to Delete?")){
		        $.ajax({
		            url:'{% url "training_delete" %}',
		            data:{id: id},
                    type: "GET",
		            success:function(msg){
		            	$(location).attr('href','{% url "training_view" %}');
		            },
		            error:function(xhr,textstatus,thrown){
		            }
		        });
		        return true;
			}else{
				alert("Cancel Delete Operation");
			}
		}

		function finishItem(id) {
			if(confirm("Are you sure to Finish this Training?")){
		        $.ajax({
		            url:'{% url "training_update" %}',
		            data:{id: id},
                    type: "GET",
		            success:function(msg){
		            	$(location).attr('href','{% url "training_view" %}');
		            },
		            error:function(xhr,textstatus,thrown){
		            }
		        });
		        return true;
			}else{
				alert("Cancel Update Operation");
			}
		}

		$('#startTime .input-group.date').datetimepicker({
		    weekStart: 1,
		    todayBtn:  1,
			autoclose: 1,
			todayHighlight: 1,
			startView: 2,
			forceParse: 0,
		    showMeridian: 1
		});

		$('#endTime .input-group.date').datetimepicker({
		    weekStart: 1,
		    todayBtn:  1,
			autoclose: 1,
			todayHighlight: 1,
			startView: 2,
			forceParse: 0,
		    showMeridian: 1
		});

    	$(document).ready(function() {
            $('.footable').footable();
        });

        $("#training-add-button").click(function() {
            $("#trainingModal").modal();
        });

        $("#training-submit-button").click(function() {
            var trainingName = $("#trainingName").val();
            var trainingDesc = $("#trainingDesc").val();
            var startDate = $("#startTime").find("input").val();
            var endDate = $("#endTime").find("input").val();
            //var zoneId = $("#zoneId").val();
            //var instructorId = $("#instructorId").val();

//          if(!confirm('Create a new team with the name ' + team_name + '?')){
// 		        return false;
// 			}

            $.ajax({
                url: '{% url "training_create" %}',
                type: "POST",
                data: JSON.stringify({ 
                    name: trainingName,
                    desc: trainingDesc,
                    startDate: startDate,
                    endDate: endDate
                    //zoneId:zoneId,
                    //instructorId:instructorId,
                    //leader_id: team_leader_id,
                }),
                success: function(data) {
                    if (data.error_code == 0) {
                        alert("SUCCESS");
                        ret = true;
                    } else {
                        alert("Oops! We have encountered an error " + data.error_msg + "!");
                        ret = false;
                    }
                    var training_name_ele = document.getElementById("trainingName");
                    training_name_ele.value = '';
                    $('#trainingModal').modal('hide');
                    window.location.reload();
                },
            });
            return ret;
        });
        
        // $("#team-cancel-button").click(function() {
        //     var team_name_ele = document.getElementById("team-name");
        //     var team_leader_id_ele = document.getElementById("team-leader");
        //     team_name_ele.value = '';
        //     team_leader_id_ele.value = '';
        // });
        
        
    </script>

</body>

</html>